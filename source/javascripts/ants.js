var us=us||{};us.dontstop=us.dontstop||{};us.dontstop.dstyge=us.dontstop.dstyge||{};
(function(f){f.LiveCode=function(a){this.global=a};f.LiveCode.NAMESPACE_SEPARATOR=".";f.LiveCode.prototype.reload=function(){var a=us.dontstop.dom.getElementsByTagNameAndClass("head")[0],c,b,d;c=us.dontstop.dom.getElementsByTagNameAndClass("script","reload",function(a){var b=(new Date).getTime(),c=a.getAttribute("src"),d=a.getAttribute("id"),f=a.getAttribute("class"),l;l=c.indexOf("?");l!==-1&&(c=c.slice(0,l));c+="?cb="+b;console.log("Adding <script src="+c+" id="+d+" class="+f+"><\/script>");b=us.dontstop.dom.createDom("script",
{src:c,id:d,"class":f});return[a,b]});for(b=0,d=c.length;b<d;b+=1)us.dontstop.dom.removeNode(c[b][0]),us.dontstop.dom.appendChild(a,c[b][1])};f.LiveCode.prototype.provideModule=function(){return this};f.LiveCode.prototype.dependsOn=function(){return this};f.LiveCode.prototype.beginTransaction=function(){return new f.Transaction(this.global)};f.LiveCode.prototype.withTransaction=function(a){var c=this.beginTransaction();try{a(c),c.commit()}catch(b){console.log("Could not create library: ",b),c.rollback()}return this};
f.TransactionClosedException=function(a){this.message=a||"The transaction is closed.";this.name="TransactionClosedException"};f.TransactionClosedException.prototype.toString=function(){return this.name+": "+this.message};f.FunctionExpectedException=function(a,c){this.message=c||"Expected function"+(a?": "+a:".");this.name="FunctionExpectedException"};f.FunctionExpectedException.prototype.toString=function(){return this.name=": "+this.message};f.ObjTransaction=function(a,c){this.transaction=a;this.obj=
c};f.ObjTransaction.prototype.method=function(a,c){this.transaction.addFunctionToPrototype(this.obj,a,c);return this};f.ObjTransaction.prototype.CONST=function(a,c){this.transaction.addConstant(this.obj,a,c);return this};f.ObjTransaction.prototype.fn=function(a,c){this.transaction.addFunction(this.obj,a,c);return this};f.ObjTransaction.prototype.mixin=function(a){this.transaction.addFunctionsFromObject(this.obj,a);return this};f.Transaction=function(a){this.global=a;this.journal=[];this.done=this.rolledBack=
this.committed=false};f.Transaction.prototype.checkStatus=function(){if(this.done)throw new TransactionClosedException;};f.Transaction.prototype.checkFunction=function(a,c){if(typeof c!=="function")throw new FunctionExpectedException(a);};f.Transaction.prototype.ns=function(a){return new f.ObjTransaction(this,this.createNamespace(a))};f.Transaction.prototype.createNamespace=function(a){var c=this.journal,b;this.checkStatus();this.descendDottedString(a,function(a,e,j){e===void 0&&(a[j]={},c[c.length]=
function(){delete a[j]});b=a[j]});return b};f.Transaction.prototype.obj=function(a,c){return new f.ObjTransaction(this,this.createObject(a,c))};f.Transaction.prototype.createObject=function(a,c){var b,d,e,j=this.journal;this.checkStatus();this.checkFunction(a,c);this.createNamespace(a);this.descendDottedString(a,function(a,c,j){b=a;d=c;e=j});typeof b[e]!=="function"&&(j[j.length]=function(){b[e]=d},b[e]=function(){this.init.apply(this,arguments)});this.addFunctionToPrototype(b[e],"init",c);return b[e]};
f.Transaction.prototype.descendDottedString=function(a,c){var b=0,d,e=this.global,j=f.LiveCode.NAMESPACE_SEPARATOR;this.checkStatus();for(d=a.indexOf(j);d!==-1&&e!==void 0;d=a.indexOf(j,b))b=a.slice(b,d),c(e,e[b],b),e=e[b],b=d+1;e!==void 0&&(b=a.slice(b),c(e,e[b],b))};f.Transaction.prototype.method=function(a,c,b){this.addFunctionToPrototype(a,c,b);return this};f.Transaction.prototype.addFunctionToPrototype=function(a,c,b){var d,e=this.journal;this.checkStatus();this.checkFunction(c,b);d=a.prototype[c];
e[e.length]=d!==void 0?function(){a.prototype[c]=d}:function(){delete a.prototype[c]};a.prototype[c]=b};f.Transaction.prototype.CONST=function(a,c,b){this.addConstant(a,c,b);return this};f.Transaction.prototype.addConstant=function(a,c,b){var d,e=this.journal;this.checkStatus();d=a[c];e[e.length]=d!==void 0?function(){a[c]=d}:function(){delete a[c]};a[c]=b};f.Transaction.prototype.fn=function(a,c,b){this.addFunction(a,c,b);return this};f.Transaction.prototype.addFunction=function(a,c,b){var d=this.journal;
this.checkStatus();this.checkFunction(c,b);d[d.length]=a[c]!==void 0?function(){a[c]=b}:function(){delete a[c]};a[c]=b};f.Transaction.prototype.addFunctionsFromObject=function(a,c){for(var b in c)b!=="init"&&c.hasOwnProperty(b)&&typeof c[b]==="function"&&this.addFunctionToPrototype(a,b,c[b])};f.Transaction.prototype.mixin=function(a,c){this.addFunctionsFromObject(a,c);return this};f.Interval=function(a,c){this.interval=a;this.fn=c};f.Transaction.prototype.setInterval=function(a,c,b,d){var e=this.journal,
j,h,g;j=a[c];j!==void 0?(h=j.interval,g=j.fn):(j=a[c]=new f.Interval(b,d),j.intervalCode=setInterval(function(){a[c].fn()},b));g!==void 0&&(e[e.length]=function(){j.fn=g});if(h!==void 0&&h!==b)j.intervalCode=setInterval(function(){a[c].fn()},b),j.interval=b,e[e.length]=function(){clearInterval(j.intervalCode);j.interval=h;j.intervalCode=setInterval(function(){a[c].fn()},h)}};f.Transaction.prototype.commit=function(){this.checkStatus();this.journal=[];this.committed=this.done=true};f.Transaction.prototype.rollback=
function(){var a,c=this.journal;this.checkStatus();for(a=c.length;a--;)c[a]();this.rolledBack=this.done=true}})(us.dontstop.dstyge);(new us.dontstop.dstyge.LiveCode(window)).provideModule("dstyge.loop").dependsOn("dstyge").withTransaction(function(f){f.obj("us.dontstop.dstyge.Loop",function(){}).method("start",function(a){var c=this;this.loopCode!==void 0&&clearInterval(this.loopCode);this.loopCode=setInterval(function(){c.step()},a)}).method("pause",function(){this.loopCode!==void 0&&(clearInterval(this.loopCode),delete this.loopCode)}).method("isLooping",function(){return this.loopCode!==void 0})});(new us.dontstop.dstyge.LiveCode(window)).provideModule("dstyge.dom").dependsOn("dstyge").withTransaction(function(f){f.ns("us.dontstop.dom").fn("getElement",function(a){return document.getElementById(a)}).fn("getElementsByTagNameAndClass",function(a,c,b){var a=document.getElementsByTagName(a),d,e,j=[],h,g;for(d=0,e=a.length;d<e;d+=1)if(h=a[d],g=h.className,!c||(" "+g+" ").indexOf(" "+c+" ")!==-1)(h=b?b(h):h)&&(j[j.length]=h);return j}).fn("createDom",function(a,c){var b=document.createElement(a),
d;for(d in c)c.hasOwnProperty(d)&&b.setAttribute(d,c[d]);return b}).fn("removeNode",function(a){var c=a.parentNode;c&&c.removeChild(a)}).fn("appendChild",function(a,c){a.appendChild(c)})});(new us.dontstop.dstyge.LiveCode(window)).provideModule("dstyge.event").dependsOn("dstyge").withTransaction(function(f){f.ns("us.dontstop.event").fn("listen",function(a,c,b){a.addEventListener?a.addEventListener(c,b):a.attachEvent&&a.attachEvent("on"+c,b)})});(new us.dontstop.dstyge.LiveCode(window)).provideModule("brigh.quadtree").dependsOn("dstyge").withTransaction(function(f){f.ns("brigh.graph");f.obj("brigh.graph.QuadTree",function(a,c,b){this.width=a;this.height=c;this.smallest=b||10;this.root=[0,0,0,0]}).method("clear",function(){this.root=[0,0,0,0]}).method("addObject",function(a,c,b){if(c===void 0)c=a.x,b=a.y;c=this.findDivision(c,b,true);c[c.length]=a}).method("moveObject",function(a,c,b,d,e){this.removeObject(a,c,b);this.addObject(a,d,e)}).method("removeObject",
function(a,c,b){if(c===void 0)c=a.x,b=a.y;var c=this.findDivision(c,b,false),d;for(b=0,d=c.length;b<d;b+=1)if(c[b]===a){c.splice(b,1);return}console.log("did not remove object: "+a)}).method("findObjects",function(a,c,b){var d=[],e=b*b;this.findDivisions(a,c,b,function(b){var h,g,f,l,i,k;for(h=0,g=b.length;h<g;h+=1)if(i=b[h],f=i.x-a,l=i.y-c,k=f*f+l*l,k<=e)d[d.length]=i,i.distance=Math.sqrt(k),i.unitX=f/i.distance,i.unitY=l/i.distance});return d}).method("findDivisions",function(a,c,b,d){var e=[[0,
0,this.width,this.height,this.root]],j=this.smallest,h,g=a-b,f=c-b;a+=b;c+=b;for(var l,i,k,m,n;e.length>0;)h=e.shift(),b=h[0],l=h[1],i=h[2],k=h[3],h=h[4],m=(b+i)/2,n=(l+k)/2,g>i||a<b||f>k||c<l||(i-b<=j&&k-l<=j?d(h):(h[0]!==0&&(e[e.length]=[b,l,m,n,h[0]]),h[1]!==0&&(e[e.length]=[m,l,i,n,h[1]]),h[2]!==0&&(e[e.length]=[b,n,m,k,h[2]]),h[3]!==0&&(e[e.length]=[m,n,i,k,h[3]])))}).fn("intersects",function(a,c,b,d,e,j,h){a=Math.abs(a-j);c=Math.abs(c-h);d=j-d;e=h-e;if(a>d+b)return false;if(c>e+b)return false;
if(a<=d)return true;if(c<=e)return true;h=a-d;e=c-e;return h*h+e*e<=b*b}).method("findDivision",function(a,c,b){for(var d=this.root,e=0,j=this.width,h=this.width/2,g=0,f=this.height,l=this.height/2,i=this.smallest,k;j-e>i&&f-g>i;){a<h?(c<l?(k=0,f=l):(k=2,g=l),j=h):(c<l?(k=1,f=l):(k=3,g=l),e=h);h=(e+j)/2;l=(g+f)/2;if(d[k]===0){if(!b)return null;d[k]=j-e<=i&&f-g<=i?[]:[0,0,0,0]}d=d[k]}return d}).method("toString",function(){return Array.prototype.toString.apply(this.root)})});(new us.dontstop.dstyge.LiveCode(window)).provideModule("brigh.ants").dependsOn("dstyge").dependsOn("dstyge.dom").dependsOn("brigh.graph.quadtree").withTransaction(function(f){f.ns("brigh.ants").CONST("WIDTH",500).CONST("HEIGHT",500).CONST("SIGHT_DISTANCE",50).CONST("FOOD_PICKUP_DISTANCE",5).CONST("FOOD_DROPOFF_DISTANCE",5).CONST("ENTITY_SIZE",7).CONST("ANT_SIZE",brigh.ants.ENTITY_SIZE).CONST("FOOD_SIZE",brigh.ants.ENTITY_SIZE).CONST("TRAIL_SIZE",brigh.ants.ENTITY_SIZE-5).CONST("MARK_TYPES",{a:1,
b:1,c:1,d:1,e:1}).CONST("MARK_DELAY",15).CONST("MARK_DEATH",3E3).CONST("STOP_MARK_DELAY",600).CONST("HOME_X",325).CONST("HOME_Y",125).CONST("HOME_SIZE",brigh.ants.ENTITY_SIZE).CONST("SHOW_SIGHT_RADIUS",false).CONST("SHOW_DIRECTION",false).CONST("SHOW_MARKS_FOLLOWING",false).CONST("SHOW_SIGHT_CONE",false).CONST("SHOW_MARKS",false).CONST("HEARTS_MODE",false);f.ns("brigh.ants.internal").CONST("TWO_PI",2*Math.PI).CONST("TWO_PI_DIV_16",2*Math.PI/16).fn("measureArray",function(a,c,b,d){var e,f,h,g,o=brigh.ants.SIGHT_DISTANCE*
brigh.ants.SIGHT_DISTANCE;for(e=0,f=b.length;e<f;e+=1)h=b[e],h!==a&&(g=brigh.ants.internal.distanceSquared(a.x,a.y,h.x,h.y),g<o&&(g=Math.sqrt(g),d[d.length]=new brigh.ants.Measurement(c||h.getMeasureName(),Math.atan2(h.y-a.y,h.x-a.x),g,1)))}).fn("distance",function(a,c,b,d){a-=b;c-=d;return Math.sqrt(a*a+c*c)}).fn("distanceSquared",function(a,c,b,d){a-=b;c-=d;return a*a+c*c}).fn("roundDir",function(a){var c=brigh.ants.internal.TWO_PI;a%=c;a<0&&(a+=c);return a}).fn("dotProduct",function(a,c,b,d){return a*
b+c*d}).fn("vecInside",function(a,c,b){a=brigh.ants.internal.roundDir(a);return c>b?a>=c||a<=b:a>=c&&a<=b});f.obj("brigh.ants.World",function(){this.ticker=0;this.width=brigh.ants.WIDTH;this.height=brigh.ants.HEIGHT;this.home={x:brigh.ants.HOME_X,y:brigh.ants.HOME_Y};this.trailsBuffer=us.dontstop.dom.createDom("canvas",{width:""+this.width,height:""+this.height});this.lastTrailDrawn=0;this.measTree=new brigh.graph.QuadTree(this.width,this.height,10);this.clear()}).method("addAnt",function(a){var c=
this.ants;c[c.length]=a;this.measTree.addObject(a.measurement)}).method("addFood",function(a){var c=this.foods;c[c.length]=a;this.measTree.addObject(a.measurement)}).method("clear",function(){this.trailsBuffer.getContext("2d").clearRect(0,0,this.width,this.height);this.lastTrailDrawn=0;this.ants=[];this.foods=[];this.antStatuses=[];this.trails=[];this.antsCarryingFood=0;this.measTree.clear();this.measTree.addObject(new brigh.ants.Measurement("home",this.home.x,this.home.y,1))}).method("getFoodCount",
function(){return this.foods.length+this.antsCarryingFood}).method("measure",function(a){var c=brigh.ants.SIGHT_DISTANCE,b=this.measTree.findObjects(a.x,a.y,c);a.x<c&&(b[b.length]=new brigh.ants.Measurement("wall",0,0,1,-1,0,a.x));a.y<c&&(b[b.length]=new brigh.ants.Measurement("wall",0,0,1,0,-1,a.y));a.x>this.width-c&&(b[b.length]=new brigh.ants.Measurement("wall",0,0,1,1,0,this.width-a.x));a.y>this.height-c&&(b[b.length]=new brigh.ants.Measurement("wall",0,0,1,0,1,this.height-a.y));return b}).method("render",
function(a){var c=this.ants,b=this.foods,d=this.trails,e=this.ticker,f,h,g,o=brigh.ants.HOME_SIZE;a.save();a.clearRect(0,0,this.width,this.height);if(brigh.ants.SHOW_MARKS){f=this.trailsBuffer.getContext("2d");if(e%brigh.ants.MARK_DELAY===0){f.clearRect(0,0,this.width,this.height);for(g=0,h=d.length;g<h;g+=1)d[g].render(f,e);this.lastTrailDrawn=h}for(g=this.lastTrailDrawn||0,h=d.length;g<h;g+=1)d[g].render(f,e);this.lastTrailDrawn=h;a.drawImage(this.trailsBuffer,0,0)}a.strokeStyle="#000000";a.strokeRect(0,
0,this.width,this.height);a.fillStyle="#c3c309";a.fillRect(this.home.x-o/2,this.home.y-o/2,o,o);for(g=0,h=b.length;g<h;g+=1)b[g].render(a);for(g=0,h=c.length;g<h;g+=1)c[g].render(a,!!(this.antStatuses[g]||{}).hasFood);a.restore()}).method("simulate",function(){var a=this.ants,c=this.trails,b,d,e,f=[],h,g;for(d=0,b=a.length;d<b;d+=1)if(h=this.antStatuses[d]||{},e=this.ants[d],f[d]=e.act(this.measure(e),!!h.hasFood,h.mark),h.mark!==void 0&&(g=h.lastTrail||-brigh.ants.MARK_DELAY,this.ticker-g>=brigh.ants.MARK_DELAY))e=
new brigh.ants.Trail(h.mark,e.x,e.y,this.ticker),this.measTree.addObject(e.measurement),c[c.length]=e,h.lastTrail=this.ticker;for(d=0,b=f.length;d<b;d+=1)this.applyIntention(a[d],this.antStatuses[d]||(this.antStatuses[d]={}),f[d]);for(d=0,b=c.length;d<b;d+=1){if(this.ticker-c[d].born<brigh.ants.MARK_DEATH){c.splice(0,d);this.lastTrailDrawn=(this.lastTrailDrawn||d)-d;break}this.measTree.removeObject(c[d].measurement)}this.ticker+=1}).method("applyIntention",function(a,c,b){var d=this.foods,e,f;if(b.type===
"move")c=brigh.ants.internal.roundDir(b.direction),d=a.x,b=a.y,a.x+=Math.cos(c),a.y+=Math.sin(c),a.measurement.x=a.x,a.measurement.y=a.y,this.measTree.moveObject(a.measurement,d,b);else if(b.type==="pickup"){if(!c.hasFood)for(b=0,e=d.length;b<e;b+=1)if(f=d[b],brigh.ants.internal.distance(a.x,a.y,f.x,f.y)<=brigh.ants.FOOD_PICKUP_DISTANCE){d.splice(b,1);this.measTree.removeObject(f.measurement);c.hasFood=true;this.antsCarryingFood+=1;break}}else if(b.type==="drop"){if(c.hasFood)brigh.ants.internal.distance(a.x,
a.y,this.home.x,this.home.y)<=brigh.ants.FOOD_DROPOFF_DISTANCE||(f=new brigh.ants.Food(a.x,a.y),d[d.length]=f,this.measTree.addObject(f.measurement)),c.hasFood=false,this.antsCarryingFood-=1}else/^mark/.test(b.type)?(a=b.type[4],brigh.ants.MARK_TYPES[a]!==void 0&&(c.mark=a)):b.type==="unmark"&&delete c.mark});f.obj("brigh.ants.Ant",function(a,c){this.x=a;this.y=c;this.measurement=new brigh.ants.Measurement("ant",a,c,1)}).method("render",function(a,c){var b=brigh.ants.ANT_SIZE,d=this.x,e=this.y;a.save();
a.fillStyle="#cc6363";brigh.ants.HEARTS_MODE?(a.beginPath(),a.moveTo(d,e+5),a.lineTo(d-5,e),a.lineTo(d-3,e-3),a.lineTo(d,e),a.lineTo(d+3,e-3),a.lineTo(d+5,e),a.lineTo(d,e+5),a.fill()):a.fillRect(this.x-b/2,this.y-b/2,b,b);if(c)a.fillStyle="#63cc63",a.fillRect(this.x-b/2+2,this.y-b/2+2,b-4,b-4);brigh.ants.SHOW_SIGHT_RADIUS&&(a.beginPath(),a.arc(this.x,this.y,brigh.ants.SIGHT_DISTANCE,0,brigh.ants.internal.TWO_PI,false),a.stroke());if(brigh.ants.SHOW_DIRECTION&&this.dirX&&this.dirY)a.beginPath(),a.moveTo(this.x,
this.y),a.lineTo(this.x+this.dirX,this.y+this.dirY),a.strokeStyle="#63cc63",a.stroke();if(brigh.ants.SHOW_MARKS_FOLLOWING&&this.marks){a.strokeStyle="#6363cc";for(b=0,d=this.marks.length;b<d;b+=1)e=this.marks[b],a.beginPath(),a.moveTo(this.x,this.y),a.lineTo(e.x,e.y),a.stroke()}if(brigh.ants.SHOW_SIGHT_CONE&&this.inFrontLeast!==void 0)a.strokeStyle="#666666",a.beginPath(),a.moveTo(this.x,this.y),a.lineTo(this.x+Math.cos(this.inFrontLeast)*brigh.ants.SIGHT_DISTANCE,this.y+Math.sin(this.inFrontLeast)*
brigh.ants.SIGHT_DISTANCE),a.stroke(),a.beginPath(),a.moveTo(this.x,this.y),a.lineTo(this.x+Math.cos(this.inFrontMost)*brigh.ants.SIGHT_DISTANCE,this.y+Math.sin(this.inFrontMost)*brigh.ants.SIGHT_DISTANCE),a.stroke();a.restore()}).method("act",function(a,c,b){var d=0,e=0,f,h,g,o=Math.cos(this.dir),l=Math.sin(this.dir),i,k=Math.sin(Math.PI/8),m=false,n=false,p=i=false;if(this.markTimeRemaining!==void 0){if(this.markTimeRemaining<=0)return delete this.markTimeRemaining,new brigh.ants.Intention("unmark");
this.markTimeRemaining-=1}this.marks=[];this.inFrontLeast=k;this.inFrontMost=1;for(f=0,h=a.length;f<h;f+=1)if(g=a[f],g.distance!==0){if(c)if(g.type==="home"){d=g.unitX*g.distance*10;e=g.unitY*g.distance*10;if(g.distance<=brigh.ants.FOOD_DROPOFF_DISTANCE)return new brigh.ants.Intention("drop");n=true}else g.type==="marka"&&!n&&(i=brigh.ants.internal.dotProduct(o,l,g.unitX,g.unitY),i>=k&&i<=1&&(d+=g.unitX*10,e+=g.unitY*10,this.marks[this.marks.length]=g),i=true);else if(g.type==="food"){!m&&g.distance>
0&&(d=g.unitX*g.distance*10,e=g.unitY*g.distance*10);if(g.distance<=brigh.ants.FOOD_PICKUP_DISTANCE)return b!=="b"?(this.markTimeRemaining=brigh.ants.STOP_MARK_DELAY,new brigh.ants.Intention("markb")):new brigh.ants.Intention("pickup");m=true}else g.type==="markb"&&!m&&(i=brigh.ants.internal.dotProduct(o,l,g.unitX,g.unitY),i>=k&&i<=1&&(d+=g.unitX*10,e+=g.unitY*10,this.marks[this.marks.length]=g),i=true);!m&&!n&&g.type==="ant"&&g.distance<25&&(d-=g.unitX*g.distance*0.5,e-=g.unitY*g.distance*0.5);!m&&
!n&&g.type==="wall"&&(g.distance<5&&(d=-g.unitX*g.distance,e=-g.unitY*g.distance,p=true),this.marks[this.marks.length]=g);if(g.type==="home"&&b!=="a"&&b!=="b")return this.markTimeRemaining=brigh.ants.STOP_MARK_DELAY,new brigh.ants.Intention("marka")}(d!==0||e!==0)&&(m||n||i||p)?(this.dirX=d,this.dirY=e,this.wander=void 0,a=Math.atan2(e,d)):(this.wander===void 0?this.wander=Math.random()*brigh.ants.internal.TWO_PI:this.wander+=(Math.random()-0.5)*brigh.ants.internal.TWO_PI_DIV_16,a=this.wander,this.dirX=
Math.cos(a)*5,this.dirY=Math.sin(a)*5);this.dir=a;return new brigh.ants.Intention("move",a)});f.obj("brigh.ants.Food",function(a,c){this.x=a;this.y=c;this.measurement=new brigh.ants.Measurement("food",a,c,1)}).method("render",function(a){var c=brigh.ants.FOOD_SIZE;a.save();a.fillStyle="#63cc63";a.fillRect(this.x-c/2,this.y-c/2,c,c);a.restore()});f.obj("brigh.ants.Measurement",function(a,c,b,d,e,f,h){this.type=a;this.x=c;this.y=b;this.certainty=d;this.unitX=e;this.unitY=f;this.distance=h}).method("toString",
function(){return"M("+this.type+", "+this.certainty+")"});f.obj("brigh.ants.Intention",function(a,c){this.type=a;this.direction=c}).method("toString",function(){return"I("+this.type+","+this.direction+")"});f.obj("brigh.ants.Trail",function(a,c,b,d){this.type=a;this.x=c;this.y=b;this.born=d;this.measurement=new brigh.ants.Measurement(this.getMeasureName(),c,b,1)}).CONST("COLORS","#000000,#333333,#666666,#999999,#cccccc,#cccccc".split(",")).CONST("AGE_BRACKET",Math.floor(brigh.ants.MARK_DEATH/(brigh.ants.Trail.COLORS.length-
1))).method("render",function(a,c){var b=brigh.ants.TRAIL_SIZE,d=this.x,e=this.y;a.save();a.strokeStyle=brigh.ants.Trail.COLORS[c!==void 0?Math.floor((c-this.born)/brigh.ants.Trail.AGE_BRACKET):0];a.beginPath();switch(this.type){case "a":a.moveTo(d-b,e-b);a.lineTo(d+b,e+b);a.moveTo(d+b,e-b);a.lineTo(d-b,e+b);break;case "b":brigh.ants.HEARTS_MODE?(a.moveTo(d,e+b),a.lineTo(d-b,e),a.lineTo(d-(b-1),e-(b-1)),a.lineTo(d,e),a.lineTo(d+(b-1),e-(b-1)),a.lineTo(d+b,e),a.lineTo(d,e+b)):a.arc(d,e,b,0,brigh.ants.internal.TWO_PI,
false);break;case "c":a.moveTo(d-b,e-b);a.lineTo(d,e+b);a.lineTo(d+b,e-b);break;case "d":a.moveTo(d,e-b);a.lineTo(d+b,e);a.lineTo(d,e+b);a.lineTo(d-b,e);a.lineTo(d,e-b);break;case "e":a.moveTo(d-b,e+b),a.lineTo(d,e-b),a.lineTo(d+b,e+b)}a.stroke();a.restore()}).method("getMeasureName",function(){return"mark"+this.type}).method("toString",function(){return"T("+this.type+","+this.x+", "+this.y+")"})});(new us.dontstop.dstyge.LiveCode(window)).provideModule("brigh.loop").dependsOn("dstyge").dependsOn("dstyge.dom").dependsOn("dstyge.event").dependsOn("dstyge.loop").dependsOn("brigh.ants").withTransaction(function(f){f.obj("brigh.ants.AntsLoop",function(a,c,b){var d=b.parentDivId,e=b.playBtnId,f=b.pauseBtnId,h=b.stepBtnId,g=b.reloadBtnId,o=b.resetBtnId,l=b.showTracksId,b=b.showHeartsId,i=this,k=us.dontstop.dom,m=us.dontstop.event,n=new us.dontstop.dstyge.LiveCode;this.canvas=k.createDom("canvas",
{width:""+a,height:""+c});this.context=this.canvas.getContext("2d");this.parentDiv=d&&k.getElement(d);this.playBtn=e&&k.getElement(e);this.pauseBtn=f&&k.getElement(f);this.stepBtn=h&&k.getElement(h);this.reloadBtn=g&&k.getElement(g);this.resetBtn=o&&k.getElement(o);this.showTracks=l&&k.getElement(l);this.showHearts=b&&k.getElement(b);this.world=new brigh.ants.World;this.playBtn&&m.listen(this.playBtn,"click",function(){i.startLooping()});this.pauseBtn&&m.listen(this.pauseBtn,"click",function(){i.pause()});
this.stepBtn&&m.listen(this.stepBtn,"click",function(){i.isLooping()||i.step()});this.reloadBtn&&m.listen(this.reloadBtn,"click",function(){n.reload()});this.resetBtn&&m.listen(this.resetBtn,"click",function(){i.reset()});if(this.showTracks)this.showTracks.checked=brigh.ants.SHOW_MARKS,m.listen(this.showTracks,"change",function(){brigh.ants.SHOW_MARKS=i.showTracks.checked});if(this.showHearts)this.showHearts.checked=brigh.ants.HEARTS_MODE,m.listen(this.showHearts,"change",function(){brigh.ants.HEARTS_MODE=
i.showHearts.checked});k.appendChild(this.parentDiv,this.canvas)}).CONST("ANT_ROWS",5).CONST("ANT_COLUMNS",5).CONST("ANT_ROW_SEPARATION",10).CONST("ANT_COLUMN_SEPARATION",10).CONST("ANT_ROW_OFFSET",105).CONST("ANT_COLUMN_OFFSET",305).CONST("FOOD_ROWS",8).CONST("FOOD_COLUMNS",8).CONST("FOOD_ROW_SEPARATION",20).CONST("FOOD_COLUMN_SEPARATION",20).CONST("FOOD_ROW_OFFSET",350).CONST("FOOD_COLUMN_OFFSET",50).CONST("INTERVAL_DELAY",25).mixin(us.dontstop.dstyge.Loop.prototype).method("startLooping",function(){this.start(brigh.ants.INTERVAL_DELAY)}).method("reset",
function(){var a=this.world,c=brigh.ants.AntsLoop,b,d,e;a.clear();for(b=0;b<c.ANT_COLUMNS;b++)for(d=0;d<c.ANT_ROWS;d++)e=new brigh.ants.Ant(b*c.ANT_COLUMN_SEPARATION+c.ANT_COLUMN_OFFSET,d*c.ANT_ROW_SEPARATION+c.ANT_ROW_OFFSET),a.addAnt(e);for(b=0;b<c.FOOD_COLUMNS;b++)for(d=0;d<c.FOOD_ROWS;d++)e=new brigh.ants.Food(b*c.FOOD_COLUMN_SEPARATION+c.FOOD_COLUMN_OFFSET,d*c.FOOD_ROW_SEPARATION+c.FOOD_ROW_OFFSET),a.addFood(e),e=new brigh.ants.Food(500-(b*c.FOOD_COLUMN_SEPARATION+c.FOOD_COLUMN_OFFSET),d*c.FOOD_ROW_SEPARATION+
c.FOOD_ROW_OFFSET),a.addFood(e),e=new brigh.ants.Food(b*c.FOOD_COLUMN_SEPARATION+c.FOOD_COLUMN_OFFSET,500-(d*c.FOOD_ROW_SEPARATION+c.FOOD_ROW_OFFSET)),a.addFood(e)}).method("step",function(){var a=this.world,c=this.context,b,d=this.simTime||0,e=this.renderTime||0,f=this.simTimes||(this.simTimes=[0,0,0,0,0]),h=this.renderTimes||(this.renderTimes=[0,0,0,0,0]),g=this.tick||0;a.getFoodCount()===0&&this.reset();b=(new Date).getTime();a.simulate();d-=f[g];f[g]=(new Date).getTime()-b;d+=f[g];this.simTime=
d;b=(new Date).getTime();a.render(c);e-=h[g];h[g]=(new Date).getTime()-b;e+=h[g];this.renderTime=e;this.tick=g=(g+1)%f.length;c.textAlign="right";c.fillText(""+Math.floor(d/5),450,499);c.fillText(""+Math.floor(e/5),499,499)})});
